---
title: "Process"
---

<div class="alert alert-danger" role="alert">
  <strong> NOTE: </strong> Testing data for K-Means Clustering ðŸ§ªðŸ§ªðŸ§ª
</div>

<details open="open">
  <summary>Table of Contents</summary>
  <ol>
    <li><a href="#dependency-imports">Dependencies</a></li>
    <li><a href="#importing-pisa-2018-data">Importing Data</a></li>
    <li><a href="#exploring-the-data">Data Exploration</a></li>
    <li><a href="#data-cleaning">Data Cleaning</a></li>
    <li><a href="#data-processing">Data Preprocessing</a></li>
    <li><a href="#acknowledgements">Acknowledgements</a></li>
  </ol>
</details>

<hr/>

### Dependency Imports
```{r message=FALSE}
library(learningtower)
library(dplyr)
library(tidyr)
library(factoextra)
library(reactable)
```

<hr/>

### Importing PISA 2018 Data
```{r message=FALSE, cache.lazy=TRUE}

# Loading the PISA 2018 data and assigning it to variable PISA_2018
PISA_2018 <- load_student(2018)

# Sampling 10 observations from the data-set for showing example
PISA_2018_SAMPLE <- sample_n(PISA_2018, 10)

# Output of the sample
reactable(PISA_2018_SAMPLE, 
  searchable = TRUE,
  striped = TRUE,
  highlight = TRUE,
  bordered = TRUE,
  theme = reactableTheme(
    borderColor = "#dfe2e5",
    stripedColor = "#f6f8fa",
    highlightColor = "#f0f5f9",
    cellPadding = "8px 12px"))
```

#### PISA 2018 Data Format

<div class="alert alert-info" role="alert">
  <strong> Total Number of Observations: </strong> 612,004 in the year 2018 alone
</div>
<table class="table table-hover">
  <thead>
    <tr>
      <th>Variable Name</th>
      <th>Variable Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>year</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>country</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>school_id</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>student_id</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>mother_educ</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>father_educ</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>gender</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>computer</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>internet</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>math</td>
      <td>Numeric</td>
    </tr>
    <tr>
      <td>science</td>
      <td>Numeric</td>
    </tr>
    <tr>
      <td>read</td>
      <td>Numeric</td>
    </tr>
    <tr>
      <td>stu_wgt</td>
      <td>Numeric</td>
    </tr>
    <tr>
      <td>desk</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>room</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>dishwasher</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>television</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>computer_n</td>
      <td>Factor</td>
    </tr>
    <tr>
      <td>car</td>
      <td>Factor</td>
    </tr>
  <tbody>
</table>

<hr/>

### Exploring the Data 

```{r message=FALSE}
# Class of the data
class(PISA_2018)

# Total number of rows and columns in the data-set
dim(PISA_2018)
```

<table class="table table-hover">
  <tr>
    <th>
      Class
    </th>
    <th>
      Dimension
    </th>
  </tr>
  <tr>
    <td align="center">
      data.frame
    </td>
    <td align="center">
      612004 Observations
      <br/>
      22 Variables
    </td>
  </tr>
</table>

#### Summary Statistics of the Data-set
```{r message=FALSE}
# Mathematics summary Stats
MATH_STAT_2018 <- summary(PISA_2018$math)
```

<table class="table table-hover">
  <tr>
    <th>
      Mininum
    </th>
    <th>
      1st Quarter
    </th>
    <th>
      Median
    </th>
    <th>
      Mean
    </th>
    <th>
      3rd Quarter
    </th>
    <th>
      Max
    </th>
    <th>
      Missing
    </th>
  </tr>
  <tr>
    <td align="center">
      24.74
    </td>
    <td align="center">
      386.66
    </td>
    <td align="center">
      460.66
    </td>
    <td align="center">
      461.22
    </td>
    <td align="center">
      535.28
    </td>
    <td align="center">
      888.06
    </td>
    <td align="center">
      5377
    </td>
  </tr>
</table>

```{r message=FALSE}
# Science summary Stats
SCI_STAT_2018 <- summary(PISA_2018$science)
```

<table class="table table-hover">
  <tr>
    <th>
      Mininum
    </th>
    <th>
      1st Quarter
    </th>
    <th>
      Median
    </th>
    <th>
      Mean
    </th>
    <th>
      3rd Quarter
    </th>
    <th>
      Max
    </th>
    <th>
      Missing
    </th>
  </tr>
  <tr>
    <td align="center">
      58.74
    </td>
    <td align="center">
      385.60
    </td>
    <td align="center">
      458.20
    </td>
    <td align="center">
      460.69
    </td>
    <td align="center">
      533.44
    </td>
    <td align="center">
      886.08
    </td>
    <td align="center">
      5377
    </td>
  </tr>
</table>
```{r message=FALSE}
  PISA_MATH_2018 <- PISA_2018$math
  hist(PISA_MATH_2018, 
       main = paste("Histogram of", "PISA 2018 Mathematics Performance"), 
       col="#3e3f3a")
```

<div class="alert alert-info" role="alert">
  <strong> Distribution: </strong> Normal
</div>

```{r message=FALSE}
  PISA_SCI_2018 <- PISA_2018$science
  hist(PISA_SCI_2018, 
       main = paste("Histogram of", "PISA 2018 Science Performance"),
       col = "#3e3f3a")
```

<div class="alert alert-info" role="alert">
  <strong> Distribution: </strong> Normal
</div>

```{r message=FALSE}
  boxplot(na.omit(PISA_MATH_2018), col="#3e3f3a")
```

```{r message=FALSE}
  boxplot(na.omit(PISA_SCI_2018), col="#3e3f3a")
```

#### Summary Statistics of the remaining Variables 

```{r echo=FALSE, message=FALSE}
  OVERALL_STAT <- summary(PISA_2018)
  OVERALL_STAT
```

### Data Cleaning

**To test K-Means Clustering we have follow its input data requirements:**  
* Numerical variables only  
* Data must have no noises or outliers  
* Data has symmetric distribution of variables (it isn't skewed)  
* Variables on the same scale  
* There is not collinearity  
* Few numbers of dimensions (Not necessary but as a general rule of thumb; fewer the better)

#### To-do's:
- [x] Renaming all columns to UPPERCASE and shorten its name
- [x] Omit NA values from all columns
- [x] Rebuilding new student profile

```{r message=FALSE}

# Renaming columns to UPPERCASE
CNT <- PISA_2018$country
SCH_ID <- PISA_2018$school_id
STU_ID <- PISA_2018$country
MOTHER_ED <- PISA_2018$mother_educ
FATHER_ED <- PISA_2018$father_educ
GENDER <- PISA_2018$gender
COMPUTER <- PISA_2018$computer
INTERNET <- PISA_2018$internet
MATH <- PISA_2018$math
SCIENCE <- PISA_2018$science
STU_WGT <- PISA_2018$stu_wgt
DESK <- PISA_2018$desk
NO_TV <- PISA_2018$television
NO_COMPUTER <- PISA_2018$computer_n
NO_CAR <- PISA_2018$car
NO_BOOK <- PISA_2018$book
WEALTH <- PISA_2018$wealth
ESCS <- PISA_2018$escs

# Rebuilding new student profile
# Invoking na.omit to remove missing values from the data-set
STUDENT_PROFILE_2018 = na.omit(data.frame(
  CNT,
  SCH_ID,
  STU_ID,
  MOTHER_ED,
  FATHER_ED,
  GENDER,
  COMPUTER,
  INTERNET,
  MATH,
  SCIENCE,
  STU_WGT,
  DESK,
  NO_TV,
  NO_COMPUTER,
  NO_CAR,
  NO_BOOK,
  WEALTH,
  ESCS
))

# Summarizing new student profile data-set
summary(STUDENT_PROFILE_2018)

# New student profile
SAMPLE_STUD_PROF_2018 <- sample_n(STUDENT_PROFILE_2018, 10)
reactable(SAMPLE_STUD_PROF_2018)
``` 

### Data Processing

As mentioned in-order for us to utilize the K-Means algorithm the first rule is 
we must have numerical variables however our data-set is a mix of both numerical
and categorical variables  

So how are going to process it in a way where we're able to use 
K-Means Clustering despite the majority of the variables being categorical?

There are multiple algorithms that we can achieve clustering despite the 
data-set being highly categorical; like K-modes, DP-means etc... 
We can still use K-means but use a different measure of distance; 
(instead of Euclidean) [Gower Distance](http://dpmartin42.github.io/posts/r/cluster-mixed-types).

Aside from K-Means and Gower we can still utilize K-Means Clustering despite 
having a mix of Numerical and Categorical and that is to map ordinal data into 
numerical values! Interesting isn't it? However this is not a good idea if your 
chosen categorical variables have no natural order but as observed in the PISA 
data-set most categorical variables are in a sense ordinal, so we're gonna 
utilize only those categorical variables that will make sense if ordered.

See here:
[K-means Clustering on Ordinal Data](https://towardsdatascience.com/k-means-clustering-on-ordinal-data-7222b5ee1693)

Here's the list of variables that is viable for mapping:  

- Father's education  
- Mother's education  
- Number of Computers the Student have  
- Number of Cars the Student's family have  
- Number of TV's the Student's family have
- Number of Book's the Student's have read

How about the already existing numerical values? We're gonna leave them as is 
and scale/normalize them later on.

I'm gonna map the aforementioned variables above in a scale of 0 to 10
Before we proceed to mapping we're gonna have to convert all variables with
factor types to character for us to reassign mapped values

```{r message=FALSE}

# Converting all factor types to character

STUDENT_PROFILE_2018$FATHER_ED <- as.character(STUDENT_PROFILE_2018$FATHER_ED)
STUDENT_PROFILE_2018$MOTHER_ED <- as.character(STUDENT_PROFILE_2018$MOTHER_ED)
STUDENT_PROFILE_2018$NO_COMPUTER <- as.character(STUDENT_PROFILE_2018$NO_COMPUTER)
STUDENT_PROFILE_2018$NO_CAR <- as.character(STUDENT_PROFILE_2018$NO_CAR)
STUDENT_PROFILE_2018$NO_TV <- as.character(STUDENT_PROFILE_2018$NO_TV)
STUDENT_PROFILE_2018$NO_BOOK <- as.character(STUDENT_PROFILE_2018$NO_BOOK)

# Mapping chosen Categorical data

STUDENT_PROFILE_2018$FATHER_ED <- ifelse(STUDENT_PROFILE_2018$`FATHER_ED`=='-', 0,
                               ifelse(STUDENT_PROFILE_2018$`FATHER_ED`=='less than ISCED1', 2,
                               ifelse(STUDENT_PROFILE_2018$`FATHER_ED`=='ISCED 3B, C', 4,
                               ifelse(STUDENT_PROFILE_2018$`FATHER_ED`=='ISCED 3A', 6,
                               ifelse(STUDENT_PROFILE_2018$`FATHER_ED`=='ISCED 2', 8,
                               ifelse(STUDENT_PROFILE_2018$`FATHER_ED`=='ISCED 1', 10,
                                                                                          NA))))))

# Transforming FATHER_ED variable to omit duplicates and reduce data-set
unique(STUDENT_PROFILE_2018[, "FATHER_ED"])

STUDENT_PROFILE_2018$MOTHER_ED <- ifelse(STUDENT_PROFILE_2018$`MOTHER_ED`=='-', 0,
                               ifelse(STUDENT_PROFILE_2018$`MOTHER_ED`=='less than ISCED1', 2,
                               ifelse(STUDENT_PROFILE_2018$`MOTHER_ED`=='ISCED 3B, C', 4,
                               ifelse(STUDENT_PROFILE_2018$`MOTHER_ED`=='ISCED 3A', 6,
                               ifelse(STUDENT_PROFILE_2018$`MOTHER_ED`=='ISCED 2', 8,
                               ifelse(STUDENT_PROFILE_2018$`MOTHER_ED`=='ISCED 1', 10,
                                                                                          NA))))))

# Transforming MOTHER_ED variable to omit duplicates and reduce data-set
unique(STUDENT_PROFILE_2018[, "MOTHER_ED"])

STUDENT_PROFILE_2018$NO_COMPUTER <- ifelse(STUDENT_PROFILE_2018$`NO_COMPUTER`=='-', 0,
                               ifelse(STUDENT_PROFILE_2018$`NO_COMPUTER`=='0', 0,
                               ifelse(STUDENT_PROFILE_2018$`NO_COMPUTER`=='1', 5,
                               ifelse(STUDENT_PROFILE_2018$`NO_COMPUTER`=='2', 8,
                               ifelse(STUDENT_PROFILE_2018$`NO_COMPUTER`=='3+', 10,
                                                                                          NA)))))

# Transforming NO_COMPUTER variable to omit duplicates and reduce data-set
unique(STUDENT_PROFILE_2018[, "NO_COMPUTER"])

STUDENT_PROFILE_2018$NO_TV <- ifelse(STUDENT_PROFILE_2018$`NO_TV`=='-', 0,
                               ifelse(STUDENT_PROFILE_2018$`NO_TV`=='0', 0,
                               ifelse(STUDENT_PROFILE_2018$`NO_TV`=='1', 6,
                               ifelse(STUDENT_PROFILE_2018$`NO_TV`=='2', 7,
                               ifelse(STUDENT_PROFILE_2018$`NO_TV`=='3+', 10,
                                                                                          NA)))))

# Transforming NO_TV variable to omit duplicates and reduce data-set
unique(STUDENT_PROFILE_2018[, "NO_TV"])

STUDENT_PROFILE_2018$NO_CAR <- ifelse(STUDENT_PROFILE_2018$`NO_CAR`=='-', 0,
                               ifelse(STUDENT_PROFILE_2018$`NO_CAR`=='0', 0,
                               ifelse(STUDENT_PROFILE_2018$`NO_CAR`=='1', 6,
                               ifelse(STUDENT_PROFILE_2018$`NO_CAR`=='2', 7,
                               ifelse(STUDENT_PROFILE_2018$`NO_CAR`=='3+', 10,
                                                                                          NA)))))

# Transforming NO_CAR variable to omit duplicates and reduce data-set
unique(STUDENT_PROFILE_2018[, "NO_CAR"])

STUDENT_PROFILE_2018$NO_BOOK <- ifelse(STUDENT_PROFILE_2018$`NO_BOOK`=='-', 0,
                               ifelse(STUDENT_PROFILE_2018$`NO_BOOK`=='0-10', 3,
                               ifelse(STUDENT_PROFILE_2018$`NO_BOOK`=='11-25', 4,
                               ifelse(STUDENT_PROFILE_2018$`NO_BOOK`=='26-100', 5,
                               ifelse(STUDENT_PROFILE_2018$`NO_BOOK`=='101-200', 7,
                               ifelse(STUDENT_PROFILE_2018$`NO_BOOK`=='201-500', 9,
                               ifelse(STUDENT_PROFILE_2018$`NO_BOOK`=='more than 500', 10,
                                                                                          NA)))))))

# We're also gonna label performances of both of MATH and SCIENCE variables

MATH_PERF <- ifelse(STUDENT_PROFILE_2018$`MATH`=='-', 0,
             ifelse(STUDENT_PROFILE_2018$`MATH`<= 500, 'Developing',
             ifelse(STUDENT_PROFILE_2018$`MATH`< 599, 'Good',
             ifelse(STUDENT_PROFILE_2018$`MATH`>= 600 , 'Excellent',
             NA))))

SCIENCE_PERF <- ifelse(STUDENT_PROFILE_2018$`SCIENCE`=='-', 0,
             ifelse(STUDENT_PROFILE_2018$`SCIENCE`<= 400, 'Developing',
             ifelse(STUDENT_PROFILE_2018$`SCIENCE`< 599, 'Good',
             ifelse(STUDENT_PROFILE_2018$`SCIENCE`>= 600 , 'Excellent',
             NA))))

# Transforming NO_BOOK variable to omit duplicates and reduce data-set
unique(STUDENT_PROFILE_2018[, "NO_BOOK"])

```

After mapping our chosen ordinal variables into somewhat an order of numerical values, we're gonna rebuild a new data-frame (including their math and science performance) and leave unnecessary variables for standardization and normalization and testing.

```{r message=FALSE}

CNT <- STUDENT_PROFILE_2018$CNT
FATHER_ED <- STUDENT_PROFILE_2018$FATHER_ED
MOTHER_ED <- STUDENT_PROFILE_2018$MOTHER_ED
NO_COMPUTER <- STUDENT_PROFILE_2018$NO_COMPUTER
NO_CAR <- STUDENT_PROFILE_2018$NO_CAR
NO_TV <- STUDENT_PROFILE_2018$NO_TV
NO_BOOK <- STUDENT_PROFILE_2018$NO_BOOK
MATH <- STUDENT_PROFILE_2018$MATH
SCIENCE <- STUDENT_PROFILE_2018$SCIENCE


# New data frame for testing data
K_MEANS_TEST_DATA = data.frame(
  CNT,
  FATHER_ED,
  MOTHER_ED,
  NO_COMPUTER,
  NO_CAR,
  NO_TV,
  NO_BOOK,
  MATH,
  MATH_PERF,
  SCIENCE,
  SCIENCE_PERF
)

```

### Testing the K-Means Algorithm
```{r}

# Initializing the Data
SAMPLE_K_MEANS_TEST_DATA <- sample_n(K_MEANS_TEST_DATA, 60)
SAMPLE_K_MEANS_TEST_DATA.LABELS = SAMPLE_K_MEANS_TEST_DATA$MATH_PERF
table(SAMPLE_K_MEANS_TEST_DATA.LABELS)
KMEANS_MATH_DATA <- SAMPLE_K_MEANS_TEST_DATA[8:4]

# Scaling the Data
SCALED_MATH_DATA <- scale(KMEANS_MATH_DATA)

# Distance
KMEANS_MATH_DATA <- dist(SCALED_MATH_DATA)

# Determining the optimal number of clusters using WSS (within sum of squares)

fviz_nbclust(SCALED_MATH_DATA, kmeans, method="wss") + labs(subtitle = "Elbow method")

# Applying K-Means

km.out <- kmeans(SCALED_MATH_DATA, centers = 3, nstart = 100)
print(km.out)
km.clusters <- km.out$cluster
rownames(SCALED_MATH_DATA) <- paste(SAMPLE_K_MEANS_TEST_DATA$CNT, 1:dim(SAMPLE_K_MEANS_TEST_DATA)[1], sep = '_')
# Visualizing the Cluster
fviz_cluster(list(data=SCALED_MATH_DATA, cluster = km.clusters))

```